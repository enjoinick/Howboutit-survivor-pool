<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NFL Preseason Survivor Pool</title>
  <meta name="description" content="NFL Preseason Survivor Pool ‚Äî live picks, margins, and draft order.">
  <meta name="theme-color" content="#6d28d9">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="apple-touch-icon" href="icons/icon-192.svg">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Tailwind CSS via Play CDN for rapid styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React and ReactDOM (development builds for easier debugging) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Chart.js for rendering bar charts -->
  <script crossorigin src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <!-- Babel Standalone enables JSX in the browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Simple styling overrides -->
  <style>
    body {
      /* fallback background gradient */
      background-image: linear-gradient(to top right, #3730a3, #6d28d9);
      font-family: 'Inter', sans-serif;
      /* Improve text size adjust compatibility */
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }
    /* Scrollbar styling for nicer look */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(255,255,255,0.1);
    }
    ::-webkit-scrollbar-thumb {
      background-color: rgba(255,255,255,0.3);
      border-radius: 4px;
    }
    /* Animations */
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes trophy {
      0%, 100% { transform: rotate(-15deg); }
      50% { transform: rotate(15deg); }
    }
    .animate-pulse-slow {
      animation: pulse 3s infinite;
    }
    .animate-fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    .animate-trophy {
      animation: trophy 2s infinite;
      display: inline-block;
    }
    /* Glass effect */
    .glass {
      background: rgba(255, 255, 255, 0.1);
      /* Safari fallback */
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    /* Eliminated effect */
    .eliminated {
      position: relative;
      overflow: hidden;
    }
    .eliminated::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(45deg, rgba(239, 68, 68, 0.3), transparent);
      z-index: 1;
    }
    .eliminated > * {
      position: relative;
      z-index: 2;
    }
    /* Winner effect */
    .winner-glow {
      box-shadow: 0 0 20px rgba(253, 224, 71, 0.7);
    }
    /* Live game indicator */
    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .live-indicator {
      animation: blink 1.5s infinite;
    }
    /* Refresh button animation */
    @keyframes rotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    .animate-rotate {
      animation: rotate 1s linear;
    }
    /* Respect reduced motion preferences */
    @media (prefers-reduced-motion: reduce) {
      .animate-fade-in,
      .animate-rotate,
      .animate-pulse-slow,
      .animate-trophy {
        animation: none !important;
      }
    }
  </style>
</head>
<body class="min-h-screen text-white font-sans">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef, useMemo } = React;
    
    // Preseason schedule used for reference
    const preseasonSchedule = [
      {
        week: 1,
        games: [
          { date: '2025-08-07', matchup: 'Indianapolis Colts at Baltimore Ravens', time: '7:00' },
          { date: '2025-08-07', matchup: 'Cincinnati Bengals at Philadelphia Eagles', time: '7:30' },
          { date: '2025-08-07', matchup: 'Las Vegas Raiders at Seattle Seahawks', time: '10:00' },
          { date: '2025-08-08', matchup: 'Detroit Lions at Atlanta Falcons', time: '7:00' },
          { date: '2025-08-08', matchup: 'Cleveland Browns at Carolina Panthers', time: '7:00' },
          { date: '2025-08-08', matchup: 'Washington Commanders at New England Patriots', time: '7:30' },
          { date: '2025-08-09', matchup: 'New York Giants at Buffalo Bills', time: '1:00' },
          { date: '2025-08-09', matchup: 'Houston Texans at Minnesota Vikings', time: '4:00' },
          { date: '2025-08-09', matchup: 'Pittsburgh Steelers at Jacksonville Jaguars', time: '7:00' },
          { date: '2025-08-09', matchup: 'Dallas Cowboys at Los Angeles Rams', time: '7:00' },
          { date: '2025-08-09', matchup: 'Tennessee Titans at Tampa Bay Buccaneers', time: '7:30' },
          { date: '2025-08-09', matchup: 'Kansas City Chiefs at Arizona Cardinals', time: '8:00' },
          { date: '2025-08-09', matchup: 'New York Jets at Green Bay Packers', time: '8:00' },
          { date: '2025-08-09', matchup: 'Denver Broncos at San Francisco 49ers', time: '8:30' },
          { date: '2025-08-10', matchup: 'Miami Dolphins at Chicago Bears', time: '1:00' },
          { date: '2025-08-10', matchup: 'New Orleans Saints at Los Angeles Chargers', time: '4:05' },
        ]
      },
      {
        week: 2,
        games: [
          { date: '2025-08-15', matchup: 'Tennessee Titans at Atlanta Falcons', time: '7:00' },
          { date: '2025-08-15', matchup: 'Kansas City Chiefs at Seattle Seahawks', time: '10:00' },
          { date: '2025-08-16', matchup: 'Miami Dolphins at Detroit Lions', time: '1:00' },
          { date: '2025-08-16', matchup: 'Carolina Panthers at Houston Texans', time: '1:00' },
          { date: '2025-08-16', matchup: 'Green Bay Packers at Indianapolis Colts', time: '1:00' },
          { date: '2025-08-16', matchup: 'New England Patriots at Minnesota Vikings', time: '1:00' },
          { date: '2025-08-16', matchup: 'Cleveland Browns at Philadelphia Eagles', time: '1:00' },
          { date: '2025-08-16', matchup: 'San Francisco 49ers at Las Vegas Raiders', time: '4:00' },
          { date: '2025-08-16', matchup: 'Baltimore Ravens at Dallas Cowboys', time: '7:00' },
          { date: '2025-08-16', matchup: 'Los Angeles Chargers at Los Angeles Rams', time: '7:00' },
          { date: '2025-08-16', matchup: 'New York Jets at New York Giants', time: '7:00' },
          { date: '2025-08-16', matchup: 'Tampa Bay Buccaneers at Pittsburgh Steelers', time: '7:00' },
          { date: '2025-08-16', matchup: 'Arizona Cardinals at Denver Broncos', time: '9:30' },
          { date: '2025-08-17', matchup: 'Jacksonville Jaguars at New Orleans Saints', time: '1:00' },
          { date: '2025-08-17', matchup: 'Buffalo Bills at Chicago Bears', time: '8:00' },
          { date: '2025-08-18', matchup: 'Cincinnati Bengals at Washington Commanders', time: '8:00' },
        ]
      },
      {
        week: 3,
        games: [
          { date: '2025-08-21', matchup: 'Pittsburgh Steelers at Carolina Panthers', time: '7:00' },
          { date: '2025-08-21', matchup: 'New England Patriots at New York Giants', time: '8:00' },
          { date: '2025-08-22', matchup: 'Philadelphia Eagles at New York Jets', time: '7:30' },
          { date: '2025-08-22', matchup: 'Atlanta Falcons at Dallas Cowboys', time: '8:00' },
          { date: '2025-08-22', matchup: 'Minnesota Vikings at Tennessee Titans', time: '8:00' },
          { date: '2025-08-22', matchup: 'Chicago Bears at Kansas City Chiefs', time: '8:20' },
          { date: '2025-08-23', matchup: 'Baltimore Ravens at Washington Commanders', time: '12:00' },
          { date: '2025-08-23', matchup: 'Indianapolis Colts at Cincinnati Bengals', time: '1:00' },
          { date: '2025-08-23', matchup: 'Los Angeles Rams at Cleveland Browns', time: '1:00' },
          { date: '2025-08-23', matchup: 'Houston Texans at Detroit Lions', time: '1:00' },
          { date: '2025-08-23', matchup: 'Denver Broncos at New Orleans Saints', time: '1:00' },
          { date: '2025-08-23', matchup: 'Seattle Seahawks at Green Bay Packers', time: '4:00' },
          { date: '2025-08-23', matchup: 'Jacksonville Jaguars at Miami Dolphins', time: '7:00' },
          { date: '2025-08-23', matchup: 'Buffalo Bills at Tampa Bay Buccaneers', time: '7:30' },
          { date: '2025-08-23', matchup: 'Los Angeles Chargers at San Francisco 49ers', time: '8:30' },
          { date: '2025-08-23', matchup: 'Las Vegas Raiders at Arizona Cardinals', time: '10:00' },
        ]
      }
    ];

    function App() {
      const [managers, setManagers] = useState([]);
      const [games, setGames] = useState([]);
      const [loading, setLoading] = useState(true);
      const [lastUpdated, setLastUpdated] = useState('');
      const [refreshing, setRefreshing] = useState(false);
      const [expanded, setExpanded] = useState(new Set()); // which manager cards are expanded on mobile
      const [chartOpen, setChartOpen] = useState(false); // lazy render chart
      const initViewApplied = useRef(false);
      const [openWeeks, setOpenWeeks] = useState(new Set()); // mobile: which schedule weeks are expanded
      const joshAudioRef = useRef(null); // easter egg audio ref
      // Public auto-persist controls
      const [autoPersist, setAutoPersist] = useState(localStorage.getItem('autoPersistEnabled') === 'true');
      const [gistIdState, setGistIdState] = useState((localStorage.getItem('gistId') || '').trim());
      const saveDebounceRef = useRef(null);
      const lastSavedHashRef = useRef('');

      // --- Helpers: calendar state from schedule dates ---
      const getWeekRange = (week) => {
        const start = new Date(week.games[0].date + 'T00:00:00');
        const end = new Date(Math.max(...week.games.map(g => new Date(g.date + 'T23:59:59').getTime())));
        return { start, end };
      };
      const computeCalendarState = (schedule) => {
        if (!schedule || !schedule.length) return { activeWeek: 1, completedWeeks: 0, totalWeeks: 0 };
        const now = new Date();
        let activeWeek = schedule[0].week;
        let completedWeeks = 0;
        for (let i = 0; i < schedule.length; i++) {
          const w = schedule[i];
          const { start, end } = getWeekRange(w);
          if (now < start) { activeWeek = w.week; break; }
          if (now >= start && now <= end) { activeWeek = w.week; break; }
          // now > end -> completed
          completedWeeks = i + 1;
          activeWeek = w.week; // will end up last if all completed
        }
        return { activeWeek, completedWeeks, totalWeeks: schedule.length };
      };
      
      // Function to load data with cache-busting (prefers Gist via config.json)
      const loadData = async () => {
        setRefreshing(true);
        const timestamp = new Date().getTime();
        // Try to read gistId from config.json
        let gistId = '';
        try {
          const cfgRes = await fetch(`config.json?t=${timestamp}`);
          if (cfgRes.ok) {
            const cfg = await cfgRes.json();
            if (cfg && cfg.gistId) gistId = cfg.gistId.trim();
          }
        } catch (e) {
          // no config found; will fall back below
        }
        // Fallback to localStorage gistId if not in config
        if (!gistId) {
          const lsId = (localStorage.getItem('gistId') || '').trim();
          if (lsId) gistId = lsId;
        }
        setGistIdState(gistId);
        // If gistId configured, try Gist first
        if (gistId) {
          try {
            const metaRes = await fetch(`https://api.github.com/gists/${gistId}`);
            if (!metaRes.ok) throw new Error(`Gist metadata fetch failed: ${metaRes.status}`);
            const meta = await metaRes.json();
            const dataFile = meta.files && (meta.files['data.json'] || meta.files['data.JSON']);
            if (!dataFile || !dataFile.raw_url) throw new Error('data.json not found in Gist');
            const res = await fetch(`${dataFile.raw_url}?t=${timestamp}`);
            if (!res.ok) throw new Error(`Gist raw fetch failed: ${res.status}`);
            const data = await res.json();
            setManagers(data.managers || []);
            setLastUpdated(data.lastUpdated || '');
            setLoading(false);
            setRefreshing(false);
            return;
          } catch (err) {
            console.error('Gist load failed, falling back to local data.json:', err);
          }
        }
        // Fallback to local data.json
        try {
          const response = await fetch(`data.json?t=${timestamp}`);
          const data = await response.json();
          setManagers(data.managers || []);
          setLastUpdated(data.lastUpdated || '');
          setLoading(false);
          setRefreshing(false);
        } catch (error) {
          console.error('Error loading data:', error);
          setLoading(false);
          setRefreshing(false);
        }
      };
      
      // Initial data load
      useEffect(() => {
        loadData();
      }, []);

      // Persist autoPersist preference locally
      useEffect(() => {
        localStorage.setItem('autoPersistEnabled', autoPersist ? 'true' : 'false');
      }, [autoPersist]);

      // Fetch scores periodically from ESPN and calculate margins
      useEffect(() => {
        let cancelled = false;
        async function fetchScores() {
          try {
            const res = await fetch('https://site.api.espn.com/apis/site/v2/sports/football/nfl/scoreboard');
            const data = await res.json();
            if (!cancelled) {
              setGames(data.events || []);
              
              // Calculate margins and results for managers' picks
              if (data.events && data.events.length > 0) {
                calculateAndUpdateFromScores(data.events);
              }
            }
          } catch (err) {
            console.error('Error fetching scores:', err);
          }
        }
        
        // Calculate margins and results based on game scores
        const calculateAndUpdateFromScores = (games) => {
          const updatedManagers = managers.map(manager => {
            let newMarginOfVictory = 0;
            let hasUpdatedPick = false;
            let newPicks = [...manager.picks];
            
            // Check each week's pick
            manager.picks.forEach((pick, weekIndex) => {
              if (pick.team) {
                // Find the game involving this team
                const game = games.find(g => {
                  const comp = g.competitions && g.competitions[0];
                  if (!comp) return false;
                  const teams = comp.competitors;
                  const home = teams.find(t => t.homeAway === 'home');
                  const away = teams.find(t => t.homeAway === 'away');
                  return (home && home.team.displayName === pick.team) ||
                         (away && away.team.displayName === pick.team);
                });
                
                if (game && game.competitions && game.competitions[0]) {
                  const comp = game.competitions[0];
                  const teams = comp.competitors;
                  const home = teams.find(t => t.homeAway === 'home');
                  const away = teams.find(t => t.homeAway === 'away');
                  const status = game.status && game.status.type && game.status.type.state;
                  
                  if (home && away && home.score !== undefined && away.score !== undefined) {
                    // Calculate margin based on which team was picked
                    let margin = 0;
                    if (home.team.displayName === pick.team) {
                      margin = home.score - away.score;
                    } else {
                      margin = away.score - home.score;
                    }
                    
                    // Determine if the team won or lost
                    const result = margin > 0 ? 'W' : 'L';
                    
                    // Only auto-update if the game is completed and this pick is not a manual override
                    if (status === 'post' && !pick.manualResult) {
                      if (pick.result !== result || pick.margin !== margin) {
                        newPicks[weekIndex] = {
                          ...pick,
                          result: result,
                          margin: margin,
                          manualResult: false, // Mark as automatic result
                          lastUpdated: new Date().toISOString()
                        };
                        hasUpdatedPick = true;
                      }
                    }
                  }
                }
              }
            });
            
            // Recompute total margin strictly from stored pick.margin values where result === 'W'
            newMarginOfVictory = newPicks.reduce((sum, p) => sum + ((p.result === 'W' && typeof p.margin === 'number') ? p.margin : 0), 0);

            // Update manager if we found valid scores or margin changed
            if (hasUpdatedPick || newMarginOfVictory !== manager.marginOfVictory) {
              return {
                ...manager,
                picks: newPicks,
                marginOfVictory: newMarginOfVictory,
                eliminated: newPicks.some(p => p.result === 'L')
              };
            }
            
            return manager;
          });
          
          // Update state if anything changed
          if (JSON.stringify(updatedManagers) !== JSON.stringify(managers)) {
            setManagers(updatedManagers);
          }
        };
        
        // Initial fetch
        fetchScores();
        // Poll every 2 minutes
        const intervalId = setInterval(fetchScores, 2 * 60 * 1000);
        return () => {
          cancelled = true;
          clearInterval(intervalId);
        };
      }, [managers]);

      // Map outcomes by team for elimination/margin derivation
      const teamOutcomeMap = useMemo(() => {
        const map = new Map();
        if (!games || !games.length) return map;
        games.forEach(ev => {
          const comp = ev.competitions && ev.competitions[0];
          if (!comp) return;
          const teams = comp.competitors || [];
          const home = teams.find(t => t.homeAway === 'home');
          const away = teams.find(t => t.homeAway === 'away');
          if (!home || !away) return;
          const state = ev.status && ev.status.type && ev.status.type.state;
          const homeScore = Number(home.score || 0);
          const awayScore = Number(away.score || 0);
          map.set(home.team.displayName, { state, isWinner: homeScore > awayScore, score: homeScore, oppScore: awayScore });
          map.set(away.team.displayName, { state, isWinner: awayScore > homeScore, score: awayScore, oppScore: homeScore });
        });
        return map;
      }, [games]);

      /**
       * Calculate elimination week and draft order
       */
      // Helper to derive elimination and week even if picks weren't persisted yet
      const deriveElimination = (mgr) => {
        // First, trust explicit losses if present
        const lossPick = (mgr.picks || []).find(p => p.result === 'L');
        if (lossPick) return { isEliminated: true, week: lossPick.week };
        // Otherwise infer from live scores: a completed (post) game with a loss
        for (const p of (mgr.picks || [])) {
          if (!p.team) continue;
          const outcome = teamOutcomeMap.get(p.team);
          if (outcome && outcome.state === 'post' && !outcome.isWinner) {
            return { isEliminated: true, week: p.week };
          }
        }
        return { isEliminated: false, week: null };
      };

      // Margin for a specific week, using stored pick.margin when present,
      // otherwise derive from live scores (teamOutcomeMap). Positive when pick's team leads.
      const getWeekMargin = (mgr, week) => {
        if (!week) return 0;
        const pick = (mgr.picks || []).find(p => p.week === week);
        if (!pick) return 0;
        if (typeof pick.margin === 'number') return pick.margin;
        if (pick.team) {
          const outcome = teamOutcomeMap.get(pick.team);
          if (outcome) return outcome.score - outcome.oppScore;
        }
        return 0;
      };

      // Draft order per provided rules (live-reactive)
      const computeDraftOrderLive = (mgrs) => {
        const totalWeeks = preseasonSchedule.length || 0;
        const withKeys = mgrs.map(mgr => {
          const derived = deriveElimination(mgr);
          const eliminationWeek = derived.isEliminated ? derived.week : (totalWeeks + 1); // survivors rank highest
          const tieWeek = derived.isEliminated ? derived.week : totalWeeks; // for survivors, use last week margin
          const weekMargin = getWeekMargin(mgr, tieWeek);
          return { ...mgr, eliminationWeek, weekMargin };
        });
        return withKeys
          .sort((a, b) => {
            // 1) Later elimination week first (survivors have totalWeeks+1)
            if (a.eliminationWeek !== b.eliminationWeek) return b.eliminationWeek - a.eliminationWeek;
            // 2) Larger margin that week higher
            if (a.weekMargin !== b.weekMargin) return b.weekMargin - a.weekMargin;
            // 3) Better last year rank (smaller number is better)
            return a.lastYearRank - b.lastYearRank;
          })
          .map((mgr, idx) => ({ ...mgr, draftOrder: idx + 1 }));
      };

      const orderedManagers = useMemo(() => computeDraftOrderLive(managers), [managers, games, preseasonSchedule]);

      // Public-side Gist save (opt-in). Uses gistId from config/localStorage and gistToken from localStorage.
      const saveToGistPublic = async (jsonStr) => {
        const id = (gistIdState || localStorage.getItem('gistId') || '').trim();
        const token = (localStorage.getItem('gistToken') || '').trim();
        if (!id || !token) {
          console.warn('Auto-save skipped: missing Gist credentials');
          return;
        }
        try {
          const payload = { files: { 'data.json': { content: jsonStr } } };
          const res = await fetch(`https://api.github.com/gists/${id}`, {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `token ${token}`
            },
            body: JSON.stringify(payload)
          });
          if (!res.ok) {
            const t = await res.text();
            throw new Error(`Gist save failed: ${res.status} ${t}`);
          }
          console.log('Auto-saved live results to Gist');
        } catch (err) {
          console.error('Auto-save to Gist failed:', err);
        }
      };

      // Debounced auto-persist when managers change and toggle is enabled
      useEffect(() => {
        if (!autoPersist) return;
        const id = (gistIdState || localStorage.getItem('gistId') || '').trim();
        const token = (localStorage.getItem('gistToken') || '').trim();
        if (!id || !token) return;
        const payloadObj = { managers, lastUpdated: new Date().toISOString() };
        const payloadStr = JSON.stringify(payloadObj, null, 2);
        if (lastSavedHashRef.current === payloadStr) return;
        if (saveDebounceRef.current) clearTimeout(saveDebounceRef.current);
        saveDebounceRef.current = setTimeout(async () => {
          await saveToGistPublic(payloadStr);
          lastSavedHashRef.current = payloadStr;
        }, 3000);
        return () => {
          if (saveDebounceRef.current) {
            clearTimeout(saveDebounceRef.current);
            saveDebounceRef.current = null;
          }
        };
      }, [managers, autoPersist, gistIdState]);
      // Initialize mobile/desktop defaults for expansions and chart section ONCE after data loads
      useEffect(() => {
        if (initViewApplied.current) return;
        if (managers.length === 0) return; // wait for first data load
        const isDesktop = window.matchMedia('(min-width: 768px)').matches; // md breakpoint
        if (isDesktop) {
          setExpanded(new Set(managers.map(m => m.name)));
          setChartOpen(true);
        } else {
          setExpanded(new Set());
          setChartOpen(false);
        }
        initViewApplied.current = true;
      }, [managers.length]);

      // Initialize mobile schedule week groups (open only active week) once schedule is loaded
      useEffect(() => {
        if (!preseasonSchedule || !preseasonSchedule.length) return;
        if (openWeeks.size > 0) return; // don't override user toggles
        const { activeWeek } = computeCalendarState(preseasonSchedule);
        setOpenWeeks(new Set([activeWeek]));
      }, [preseasonSchedule]);

      // No search/filtering ‚Äî show all managers in draft order
      const filteredManagers = orderedManagers;

      const toggleExpand = (name) => {
        setExpanded(prev => {
          const next = new Set(prev);
          if (next.has(name)) next.delete(name); else next.add(name);
          return next;
        });
      };
      const toggleWeek = (weekNum) => {
        setOpenWeeks(prev => {
          const next = new Set(prev);
          if (next.has(weekNum)) next.delete(weekNum); else next.add(weekNum);
          return next;
        });
      };
      const handleCardClick = (mgr) => {
        if (!mgr || !mgr.name) return;
        if (mgr.name.trim().toLowerCase() === 'josh' && joshAudioRef.current) {
          try {
            joshAudioRef.current.currentTime = 0;
            joshAudioRef.current.play();
          } catch (e) {
            console.warn('Easter egg audio failed to play:', e);
          }
        }
      };
      // Memoized calendar snapshot for renders
      const calendar = React.useMemo(() => computeCalendarState(preseasonSchedule), [preseasonSchedule, lastUpdated]);
      // Build data for bar chart
      const chartData = useMemo(() => orderedManagers.map(mgr => {
        const wins = mgr.picks.filter(p => p.result === 'W').length;
        return { name: mgr.name, wins };
      }), [orderedManagers]);

      // Map of scoreboard by matchup string and sorted events for display
      const scoreboardMap = useMemo(() => {
        const map = new Map();
        if (!games || !games.length) return map;
        games.forEach(ev => {
          const comp = ev.competitions && ev.competitions[0];
          if (!comp) return;
          const teams = comp.competitors || [];
          const home = teams.find(t => t.homeAway === 'home');
          const away = teams.find(t => t.homeAway === 'away');
          if (!home || !away) return;
          const key = `${away.team.displayName} at ${home.team.displayName}`;
          const state = ev.status && ev.status.type && ev.status.type.state;
          map.set(key, {
            state,
            awayScore: Number(away.score || 0),
            homeScore: Number(home.score || 0),
            date: ev.date ? new Date(ev.date) : null,
          });
        });
        return map;
      }, [games]);

      const gamesSorted = useMemo(() => {
        if (!games || !games.length) return [];
        const rank = (state) => state === 'in' ? 0 : (state === 'pre' ? 1 : 2);
        return [...games].sort((a, b) => {
          const sa = a.status && a.status.type && a.status.type.state;
          const sb = b.status && b.status.type && b.status.type.state;
          const ra = rank(sa);
          const rb = rank(sb);
          if (ra !== rb) return ra - rb;
          const da = a.date ? new Date(a.date).getTime() : 0;
          const db = b.date ? new Date(b.date).getTime() : 0;
          return da - db;
        });
      }, [games]);

      // Chart.js reference
      const chartRef = useRef(null);
      const chartInstance = useRef(null);

      // Render or update the bar chart (lazy when chartOpen)
      useEffect(() => {
        if (!chartOpen) {
          if (chartInstance.current) {
            chartInstance.current.destroy();
            chartInstance.current = null;
          }
          return;
        }
        if (!chartRef.current || chartData.length === 0) return;
        const ctx = chartRef.current.getContext('2d');
        
        // Destroy any existing chart
        if (chartInstance.current) {
          chartInstance.current.destroy();
        }
        
        chartInstance.current = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: chartData.map(item => item.name),
            datasets: [
              {
                label: 'Survived Weeks',
                data: chartData.map(item => item.wins),
                backgroundColor: chartData.map((_, idx) => 
                  orderedManagers[idx].draftOrder === 1 ? 'rgba(253, 224, 71, 0.8)' : 'rgba(99, 102, 241, 0.7)'
                ),
                borderColor: chartData.map((_, idx) => 
                  orderedManagers[idx].draftOrder === 1 ? 'rgba(253, 224, 71, 1)' : 'rgba(99, 102, 241, 1)'
                ),
                borderWidth: 1,
                borderRadius: 5
              }
            ]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                ticks: { color: '#fff', font: { size: 12 } },
                grid: { display: false }
              },
              y: {
                beginAtZero: true,
                max: 3,
                ticks: { 
                  color: '#fff', 
                  font: { size: 12 }, 
                  stepSize: 1,
                  callback: function(value) {
                    return value === 0 ? '0' : value === 1 ? '1' : value === 2 ? '2' : '3';
                  }
                },
                grid: { color: 'rgba(255, 255, 255, 0.2)' }
              }
            },
            plugins: {
              legend: {
                labels: { color: '#fff' }
              },
              tooltip: {
                backgroundColor: 'rgba(255,255,255,0.9)',
                titleColor: '#000',
                bodyColor: '#000',
                borderColor: 'rgba(0,0,0,0.1)',
                borderWidth: 1,
                callbacks: {
                  label: function(context) {
                    return `Survived: ${context.raw} week${context.raw !== 1 ? 's' : ''}`;
                  }
                }
              }
            }
          }
        });
        
        // Cleanup
        return () => {
          if (chartInstance.current) {
            chartInstance.current.destroy();
            chartInstance.current = null;
          }
        };
      }, [chartOpen, chartData, orderedManagers]);

      if (loading) {
        return (
          <div className="flex items-center justify-center min-h-screen">
            <div className="text-center">
              <div className="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-purple-500 mx-auto"></div>
              <p className="mt-4 text-xl">Loading Survivor Pool...</p>
            </div>
          </div>
        );
      }

      return (
        <div className="p-4 space-y-6 max-w-7xl mx-auto">
          {/* Easter egg audio (hidden) */}
          <audio ref={joshAudioRef} src="Audio/ImACop.mp3" preload="auto" style={{ display: 'none' }} />
          {/* Sticky Toolbar */}
          <div
            className="sticky top-0 z-50 glass rounded-xl px-3 py-2 -mx-1 md:mx-0 backdrop-blur animate-fade-in"
            style={{ paddingTop: 'calc(0.5rem + env(safe-area-inset-top))' }}
          >
            <div className="flex items-center justify-between gap-3">
              <div className="text-xs text-purple-200 whitespace-nowrap">
                Last updated: {new Date(lastUpdated).toLocaleString()}
              </div>
              <div className="flex items-center gap-3">
                <label className="hidden sm:flex items-center gap-2 text-xs select-none" title="Automatically save live results to your configured Gist">
                  <input
                    type="checkbox"
                    checked={autoPersist}
                    onChange={(e) => setAutoPersist(e.target.checked)}
                    aria-label="Enable auto-save to Gist"
                    className="h-4 w-4 rounded border-purple-400 bg-transparent"
                  />
                  Auto-save to Gist
                </label>
                <button
                  onClick={loadData}
                  disabled={refreshing || loading}
                  aria-label="Refresh data"
                  aria-busy={refreshing}
                  className={`hidden md:inline-flex items-center justify-center p-2.5 rounded-full ${refreshing ? 'bg-gray-600' : 'bg-purple-600 hover:bg-purple-700'} transition-colors`}
                  title="Refresh data"
                >
                  <i className={`fas fa-sync-alt ${refreshing ? 'animate-rotate' : ''}`}></i>
                </button>
              </div>
            </div>
          </div>

          {/* Header */}
          <header className="text-center py-6 animate-fade-in">
            <h1 className="text-3xl sm:text-4xl md:text-5xl font-bold flex items-center justify-center gap-3 drop-shadow-lg">
              <span className="animate-trophy">üèÜ</span>
              NFL Preseason Survivor Pool
            </h1>
            <p className="mt-2 text-base sm:text-lg md:text-xl">Track your league's preseason picks and draft order</p>
            <div className="mt-2 text-xs text-purple-200">
              Times shown are Eastern Time. <span className="ml-1" aria-label="Manual override indicator">Manual overrides are marked with üìù.</span>
            </div>
          </header>

          {/* Stats Overview */}
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 animate-fade-in">
            <div className="glass rounded-xl p-4 text-center">
              <div className="text-3xl font-bold text-yellow-300">{managers.length}</div>
              <div className="text-sm">Managers</div>
            </div>
            <div className="glass rounded-xl p-4 text-center">
              <div className="text-3xl font-bold text-green-400">{managers.filter(m => !deriveElimination(m).isEliminated).length}</div>
              <div className="text-sm">Still Alive</div>
            </div>
            <div className="glass rounded-xl p-4 text-center">
              <div className="text-3xl font-bold text-red-400">{managers.filter(m => deriveElimination(m).isEliminated).length}</div>
              <div className="text-sm">Eliminated</div>
            </div>
            <div className="glass rounded-xl p-4 text-center">
              <div className="text-3xl font-bold text-purple-400">{orderedManagers[0]?.name || '-'}</div>
              <div className="text-sm">Current Leader</div>
            </div>
          </div>

          {/* Draft Order Rules Legend */}
          <section className="glass rounded-2xl p-4 text-sm text-purple-100 animate-fade-in">
            <h2 className="text-lg font-semibold mb-2 flex items-center gap-2">
              <i className="fas fa-info-circle"></i> Draft Order Rules
            </h2>
            <ul className="list-disc pl-5 space-y-1">
              <li><strong>Survivors first</strong>: Last manager standing gets #1 pick; other survivors follow (#2, #3, ...).</li>
              <li><strong>Same-week elimination</strong>: Higher <em>margin of victory that week</em> ranks higher.</li>
              <li><strong>Still tied</strong>: Higher <em>last year‚Äôs finish</em> ranks higher.</li>
              <li><strong>If all eliminated same week</strong>: Use that week‚Äôs margin, then last year‚Äôs finish.</li>
            </ul>
          </section>

          {/* Manager Cards */}
          <section className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {filteredManagers.map((mgr, mgrIdx) => {
              const derived = deriveElimination(mgr);
              const eliminationWeekComputed = derived.isEliminated ? derived.week : mgr.eliminationWeek;
              const isEliminated = derived.isEliminated;
              const isWinner = mgr.draftOrder === 1;
              const isOpen = expanded.has(mgr.name);
              const completedWeeks = calendar.completedWeeks || 0;
              const totalWeeks = calendar.totalWeeks || preseasonSchedule.length;
              const winsToDate = (mgr.picks || []).filter(p => p.week <= completedWeeks && p.result === 'W').length;
              const lossesToDate = (mgr.picks || []).filter(p => p.week <= completedWeeks && p.result === 'L').length;
              let footerText = '';
              if (completedWeeks === 0) {
                footerText = 'Season upcoming ‚Ä¢ First pick: W1';
              } else if (!isEliminated && completedWeeks < totalWeeks) {
                footerText = `Through W${completedWeeks}: ${winsToDate}-${lossesToDate} ‚Ä¢ Next: W${completedWeeks + 1}`;
              } else if (!isEliminated && completedWeeks >= totalWeeks) {
                footerText = `Survived all ${totalWeeks} weeks!`;
              } else {
                footerText = `Eliminated W${eliminationWeekComputed} ‚Ä¢ Record: ${winsToDate}-${lossesToDate}`;
              }
              
              return (
                <div 
                  key={mgr.name} 
                  className={`glass rounded-2xl p-5 transition-all duration-300 transform hover:scale-[1.02] ${isEliminated ? 'eliminated' : ''} ${isWinner ? 'winner-glow' : ''} animate-fade-in`}
                  onClick={() => handleCardClick(mgr)}
                  style={{ animationDelay: `${mgrIdx * 0.1}s` }}
                >
                  <div className="flex justify-between items-start mb-2">
                    <div>
                      <div className="flex items-center gap-2">
                        <h2 className="text-xl font-bold">{mgr.name}</h2>
                        {isWinner && <span className="animate-trophy text-2xl">üèÜ</span>}
                      </div>
                      <p className="text-sm italic text-fuchsia-200">{mgr.teamLabel}</p>
                    </div>
                    <div className="flex items-start gap-2">
                      <button
                        onClick={() => toggleExpand(mgr.name)}
                        aria-expanded={isOpen}
                        aria-controls={`mgr-${mgrIdx}`}
                        aria-label={`Toggle ${mgr.name} details`}
                        className="md:hidden p-2 rounded-lg bg-white/10 hover:bg-white/20 transition-colors"
                        title="Toggle details"
                      >
                        <i className={`fas ${isOpen ? 'fa-chevron-up' : 'fa-chevron-down'}`}></i>
                      </button>
                      <div className="text-right">
                        <div className="flex items-center gap-1">
                          <span className="text-sm">Draft Pick:</span>
                          <span className={`font-bold text-lg ${isWinner ? 'text-yellow-300' : 'text-white'}`}>
                            #{mgr.draftOrder}
                          </span>
                        </div>
                        <div className="flex items-center gap-1">
                          <span className="text-sm">Margin:</span>
                          <span className="font-bold">{mgr.marginOfVictory}</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  {/* Picks display */}
                  <div id={`mgr-${mgrIdx}`} className={`${isOpen ? 'block' : 'hidden'} md:block mb-4`}>
                    <h3 className="text-sm font-semibold mb-2 text-purple-200">Weekly Picks</h3>
                    <div className="flex flex-wrap gap-1 sm:gap-2">
                      {mgr.picks.map((pick, idx) => (
                        <div
                          key={idx}
                          className={`px-2 sm:px-3 py-1 rounded-full text-[11px] sm:text-xs font-medium flex items-center gap-1 whitespace-nowrap ${
                            pick.result === 'W'
                              ? 'bg-green-500/80'
                              : pick.result === 'L'
                                ? 'bg-red-500/80'
                                : 'bg-gray-700/60'
                          }`}
                          title={`Week ${pick.week} - ${(pick.team || 'TBD')} - ${pick.result ? (pick.result === 'W' ? 'Win' : 'Loss') : 'Pending'}${pick.manualResult ? ' (Manual override)' : ''}`}
                        >
                          <span className="font-semibold">W{pick.week}</span>
                          <span className="inline max-w-[10rem] truncate sm:max-w-none" title={pick.team || 'TBD'}>{pick.team || 'TBD'}</span>
                          {pick.result && (
                            <span className="font-bold">
                              {pick.result === 'W' ? '‚úì' : '‚úó'}
                            </span>
                          )}
                          {pick.manualResult && (
                            <span className="text-xs ml-1" title="Manual override">üìù</span>
                          )}
                        </div>
                      ))}
                    </div>
                  </div>
                  
                  {/* Status indicator */}
                  <div className={`${isOpen ? 'flex' : 'hidden'} md:flex justify-between items-center mt-2 pt-3 border-t border-white/10`}>
                    <div className="text-sm">
                      {isEliminated ? (
                        <span className="text-red-400 font-medium flex items-center gap-1">
                          <i className="fas fa-skull"></i> Eliminated Week {eliminationWeekComputed}
                        </span>
                      ) : (
                        <span className="text-green-400 font-medium flex items-center gap-1">
                          <i className="fas fa-heart animate-pulse-slow"></i> Still Alive
                        </span>
                      )}
                    </div>
                    <div className="text-xs text-gray-300">{footerText}</div>
                  </div>
                </div>
              );
            })}
          </section>

          {/* Chart Section */}
          <section className="glass rounded-2xl p-5 animate-fade-in">
            <div className="flex items-center justify-between mb-2">
              <h2 className="text-xl font-semibold flex items-center gap-2">
                <i className="fas fa-chart-bar"></i> Survival Progress
              </h2>
              <button
                onClick={() => setChartOpen(o => !o)}
                aria-expanded={chartOpen}
                aria-controls="survival-chart"
                className="px-3 py-1.5 rounded-lg bg-white/10 hover:bg-white/20 transition-colors"
                aria-label="Toggle survival progress chart"
              >
                <span className="hidden sm:inline">{chartOpen ? 'Hide' : 'Show'}</span>
                <i className={`sm:ml-2 fas ${chartOpen ? 'fa-chevron-up' : 'fa-chevron-down'}`}></i>
              </button>
            </div>
            {chartOpen && (
              <div id="survival-chart" className="relative h-64">
                <canvas ref={chartRef} className="w-full h-full" />
              </div>
            )}
          </section>

          {/* Preseason Schedule */}
          <section className="glass rounded-2xl p-5 overflow-auto animate-fade-in">
            <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
              <i className="fas fa-calendar-alt"></i> Preseason Schedule (Weeks 1‚Äì3)
            </h2>
            {/* Desktop table */}
            <div className="hidden md:block overflow-x-auto">
              <table className="w-full text-sm">
                <thead className="bg-purple-800/40">
                  <tr>
                    <th className="p-2">Week</th>
                    <th className="p-2">Date</th>
                    <th className="p-2">Time (ET)</th>
                    <th className="p-2 text-left">Matchup</th>
                    <th className="p-2 text-left">Managers with Pick</th>
                  </tr>
                </thead>
                <tbody>
                  {preseasonSchedule.flatMap(week => 
                    week.games.map((game, idx) => {
                      // Extract team names from matchup
                      const teams = game.matchup.split(' at ');
                      const awayTeam = teams[0];
                      const homeTeam = teams[1];
                      const score = scoreboardMap.get(game.matchup);
                      
                      // Find managers who have picked either team for this week
                      const managersWithPick = managers.filter(manager => {
                        const pick = manager.picks.find(p => p.week === week.week);
                        return pick && pick.team && (pick.team.trim() !== '' && (pick.team === awayTeam || pick.team === homeTeam));
                      });
                      
                      return (
                        <tr key={`${week.week}-${idx}`} className={idx % 2 === 0 ? 'bg-purple-700/30' : 'bg-purple-700/20'}>
                          <td className="p-2 text-center">{week.week}</td>
                          <td className="p-2 text-center">{game.date}</td>
                          <td className="p-2 text-center">{score && score.state === 'post' ? `Final ${score.awayScore}‚Äì${score.homeScore}` : `${game.time}`}</td>
                          <td className="p-2">
                            <div className="flex items-center gap-2">
                              <span className="font-medium">{awayTeam}</span>
                              <span className="text-gray-400">@</span>
                              <span className="font-medium">{homeTeam}</span>
                            </div>
                          </td>
                          <td className="p-2">
                            {managersWithPick.length > 0 ? (
                              <div className="flex flex-wrap gap-1">
                                {managersWithPick.map((manager, mgrIdx) => (
                                  <span 
                                    key={mgrIdx}
                                    className={`px-2 py-1 rounded-full text-xs font-medium ${
                                      deriveElimination(manager).isEliminated
                                        ? 'bg-red-500/60'
                                        : 'bg-green-500/60'
                                    }`}
                                    title={`${manager.name} - ${manager.teamLabel}`}
                                  >
                                    {manager.name}
                                  </span>
                                ))}
                              </div>
                            ) : (
                              <span className="text-gray-400 text-sm">No picks</span>
                            )}
                          </td>
                        </tr>
                      );
                    })
                  )}
                </tbody>
              </table>
            </div>
            {/* Mobile grouped by week with toggles */}
            <div className="md:hidden space-y-3">
              {preseasonSchedule.map(week => {
                const isOpen = openWeeks.has(week.week);
                return (
                  <div key={`week-${week.week}`} className="rounded-xl bg-indigo-900/20">
                    <button
                      onClick={() => toggleWeek(week.week)}
                      className="w-full flex items-center justify-between p-3"
                      aria-expanded={isOpen}
                      aria-controls={`week-${week.week}-games`}
                    >
                      <span className="font-semibold">Week {week.week}</span>
                      <i className={`fas ${isOpen ? 'fa-chevron-up' : 'fa-chevron-down'}`}></i>
                    </button>
                    {isOpen && (
                      <div id={`week-${week.week}-games`} className="px-3 pb-3 space-y-2">
                        {week.games.map((game, idx) => {
                          const teams = game.matchup.split(' at ');
                          const awayTeam = teams[0];
                          const homeTeam = teams[1];
                          const score = scoreboardMap.get(game.matchup);
                          const managersWithPick = managers.filter(manager => {
                            const pick = manager.picks.find(p => p.week === week.week);
                            return pick && pick.team && (pick.team.trim() !== '' && (pick.team === awayTeam || pick.team === homeTeam));
                          });
                          return (
                            <div key={`${week.week}-m-${idx}`} className="rounded-lg bg-indigo-900/30 p-3">
                              <div className="flex items-center justify-between text-sm">
                                <div className="font-semibold">{score && score.state === 'post' ? `Final ${score.awayScore}‚Äì${score.homeScore}` : `${game.time} ET`}</div>
                                <div className="text-xs text-purple-200">{game.date}</div>
                              </div>
                              <div className="mt-1 font-medium">
                                {awayTeam} <span className="text-gray-400">@</span> {homeTeam}
                              </div>
                              {managersWithPick.length > 0 ? (
                                <div className="mt-2 flex flex-wrap gap-1">
                                  {managersWithPick.map((manager, mgrIdx) => (
                                    <span key={mgrIdx} className="px-2 py-0.5 rounded-full text-[11px] bg-green-500/60">{manager.name}</span>
                                  ))}
                                </div>
                              ) : (
                                <div className="mt-2 text-gray-300 text-xs">No picks</div>
                              )}
                            </div>
                          );
                        })}
                      </div>
                    )}
                  </div>
                );
              })}
            </div>
          </section>

          {/* Live Scoreboard Section */}
          <section className="glass rounded-2xl p-5 overflow-auto animate-fade-in">
            <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
              <i className="fas fa-football-ball"></i> Live Scoreboard
              {games.length > 0 && (
                <span className="ml-2 px-2 py-1 bg-red-500 text-xs rounded-full live-indicator">
                  LIVE
                </span>
              )}
            </h2>
            {games && games.length > 0 ? (
              <>
                {/* Desktop table */}
                <div className="hidden md:block overflow-x-auto">
                  <table className="w-full text-sm">
                    <thead className="bg-indigo-800/40">
                      <tr>
                        <th className="p-2 text-left">Matchup</th>
                        <th className="p-2 text-center">Score</th>
                        <th className="p-2 text-center">Status</th>
                      </tr>
                    </thead>
                    <tbody>
                      {gamesSorted.map((ev, idx) => {
                        const comp = ev.competitions && ev.competitions[0];
                        if (!comp) return null;
                        const teams = comp.competitors;
                        const home = teams.find(t => t.homeAway === 'home');
                        const away = teams.find(t => t.homeAway === 'away');
                        const statusDesc = ev.status && ev.status.type && ev.status.type.shortDetail;
                        const isCompleted = ev.status && ev.status.type && ev.status.type.state === 'post';
                        
                        return (
                          <tr key={idx} className={idx % 2 === 0 ? 'bg-indigo-700/30' : 'bg-indigo-700/20'}>
                            <td className="p-2">
                              <div className="flex items-center gap-2">
                                <div>{away.team.displayName}</div>
                                <div className="text-gray-400">@</div>
                                <div>{home.team.displayName}</div>
                              </div>
                            </td>
                            <td className="p-2 text-center font-mono">
                              {away.score} ‚Äì {home.score}
                            </td>
                            <td className="p-2 text-center">
                              <span className={`px-2 py-1 rounded-full text-xs ${
                                isCompleted 
                                  ? 'bg-green-500/80' 
                                  : 'bg-yellow-500/80'
                              }`}>
                                {statusDesc}
                              </span>
                            </td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>
                {/* Mobile cards */}
                <div className="md:hidden space-y-3">
                  {gamesSorted.map((ev, idx) => {
                    const comp = ev.competitions && ev.competitions[0];
                    if (!comp) return null;
                    const teams = comp.competitors;
                    const home = teams.find(t => t.homeAway === 'home');
                    const away = teams.find(t => t.homeAway === 'away');
                    const statusDesc = ev.status && ev.status.type && ev.status.type.shortDetail;
                    const state = ev.status && ev.status.type && ev.status.type.state;
                    const isCompleted = state === 'post';
                    return (
                      <div key={`m-${idx}`} className="rounded-lg bg-indigo-900/30 p-3">
                        <div className="flex items-center justify-between">
                          <div className={`text-sm px-2 py-0.5 rounded-full font-semibold ${isCompleted ? 'bg-green-300 text-black' : (state === 'in' ? 'bg-red-300 text-black' : 'bg-yellow-300 text-black')}`}>{isCompleted ? 'Final' : (state === 'in' ? 'Live' : 'Scheduled')}</div>
                        </div>
                        <div className="mt-2">
                          <div className="flex justify-between text-sm">
                            <span className="font-medium">{away.team.displayName}</span>
                            <span className="font-mono">{away.score}</span>
                          </div>
                          <div className="text-center text-gray-400 text-xs">@</div>
                          <div className="flex justify-between text-sm">
                            <span className="font-medium">{home.team.displayName}</span>
                            <span className="font-mono">{home.score}</span>
                          </div>
                          {statusDesc && (
                            <div className="mt-1 text-sm font-mono text-purple-100">{statusDesc}</div>
                          )}
                        </div>
                      </div>
                    );
                  })}
                </div>
              </>
            ) : (
              <div className="text-center py-8">
                <i className="fas fa-info-circle text-3xl text-purple-300 mb-2"></i>
                <p className="text-purple-200">No games in progress or data unavailable.</p>
              </div>
            )}
          </section>

          {/* Mobile Refresh FAB */}
          <button
            onClick={loadData}
            disabled={refreshing || loading}
            aria-label="Refresh data"
            aria-busy={refreshing}
            className={`sm:hidden fixed right-[calc(1rem+env(safe-area-inset-right))] bottom-[calc(1rem+env(safe-area-inset-bottom))] p-4 rounded-full shadow-lg ${refreshing ? 'bg-gray-600' : 'bg-purple-600 hover:bg-purple-700'} transition-colors`}
            title="Refresh data"
          >
            <i className={`fas fa-sync-alt ${refreshing ? 'animate-rotate' : ''}`}></i>
          </button>

          {/* Footer */}
          <footer className="text-center py-6 text-sm text-purple-300 border-t border-white/10">
            <p>NFL Preseason Survivor Pool ‚Ä¢ Draft order determined by survival and margin of victory</p>
            <p className="mt-1">Admin: <a href="admin.html" className="text-purple-200 hover:text-white">Manage Pool</a></p>
          </footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
  <script>
    // Register service worker for PWA installability and offline fallback
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch((err) => {
          console.warn('Service worker registration failed:', err);
        });
      });
    }
  </script>
</body>
</html>

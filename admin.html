<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - NFL Survivor Pool</title>
  <!-- Tailwind CSS via Play CDN for rapid styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React and ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel Standalone enables JSX in the browser -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <!-- Font Awesome for icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body {
      background-image: linear-gradient(to top right, #3730a3, #6d28d9);
      font-family: 'Inter', sans-serif;
      /* Improve text size adjust compatibility */
      -webkit-text-size-adjust: 100%;
      text-size-adjust: 100%;
    }
    .glass {
      background: rgba(255, 255, 255, 0.1);
      /* Safari fallback */
      -webkit-backdrop-filter: blur(10px);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 1001;
      animation: slideIn 0.3s ease-out;
    }
    @keyframes slideIn {
      from { transform: translateX(100%); }
      to { transform: translateX(0); }
    }
    .success { background-color: #10b981; }
    .error { background-color: #ef4444; }
    
    /* Fixed dropdown styling */
    select {
      background-color: #1f2937 !important;
      color: white !important;
      border: 1px solid #4b5563 !important;
    }
    select option {
      background-color: #374151 !important;
      color: white !important;
    }
    select:focus {
      outline: none !important;
      border-color: #8b5cf6 !important;
      box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3) !important;
    }
    input[type="text"], input[type="number"], input[type="password"] {
      background-color: rgba(75, 85, 99, 0.7) !important;
      border: 1px solid #6B7280 !important;
    }
  </style>
</head>
<body class="min-h-screen text-white font-sans">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    
    // Complete list of NFL teams
    const nflTeams = [
      'Arizona Cardinals','Atlanta Falcons','Baltimore Ravens','Buffalo Bills','Carolina Panthers','Chicago Bears',
      'Cincinnati Bengals','Cleveland Browns','Dallas Cowboys','Denver Broncos','Detroit Lions','Green Bay Packers',
      'Houston Texans','Indianapolis Colts','Jacksonville Jaguars','Kansas City Chiefs','Las Vegas Raiders',
      'Los Angeles Chargers','Los Angeles Rams','Miami Dolphins','Minnesota Vikings','New England Patriots',
      'New Orleans Saints','New York Giants','New York Jets','Philadelphia Eagles','Pittsburgh Steelers',
      'San Francisco 49ers','Seattle Seahawks','Tampa Bay Buccaneers','Tennessee Titans','Washington Commanders'
    ];

    function AdminPanel() {
      const [authenticated, setAuthenticated] = useState(false);
      const [managers, setManagers] = useState([]);
      const [jsonData, setJsonData] = useState('');
      const [showJson, setShowJson] = useState(false);
      const [password, setPassword] = useState('');
      const [error, setError] = useState('');
      const [notification, setNotification] = useState(null);
      const [showChangePassword, setShowChangePassword] = useState(false);
      const [newPassword, setNewPassword] = useState('');
      const [confirmPassword, setConfirmPassword] = useState('');
      const [showAddManager, setShowAddManager] = useState(false);
      const [newManager, setNewManager] = useState({
        name: '',
        teamLabel: '',
        lastYearRank: 11
      });
      // Gist persistence settings
      const [showSettings, setShowSettings] = useState(false);
      const [gistId, setGistId] = useState(localStorage.getItem('gistId') || '');
      const [gistToken, setGistToken] = useState(localStorage.getItem('gistToken') || '');
      const [isSaving, setIsSaving] = useState(false);
      const [dirty, setDirty] = useState(false);
      // File input ref for importing JSON
      const fileInputRef = useRef(null);
      
      // Check password on load
      useEffect(() => {
        const storedAuth = localStorage.getItem('adminAuthenticated');
        if (storedAuth === 'true') {
          setAuthenticated(true);
          loadData();
        }
      }, []);

      // If no gistId in localStorage, try to default from config.json
      useEffect(() => {
        if (!gistId) {
          fetch(`config.json?t=${Date.now()}`)
            .then(res => res.ok ? res.json() : null)
            .then(cfg => {
              if (cfg && cfg.gistId) {
                setGistId(cfg.gistId);
                localStorage.setItem('gistId', cfg.gistId);
              }
            })
            .catch(() => {});
        }
      }, [gistId]);
      
      const handleLogin = () => {
        const storedPassword = localStorage.getItem('adminPassword') || 'survivor2025';
        if (password === storedPassword) {
          setAuthenticated(true);
          localStorage.setItem('adminAuthenticated', 'true');
          setError('');
          loadData();
        } else {
          setError('Incorrect password');
        }
      };
      
      const handleChangePassword = () => {
        if (newPassword !== confirmPassword) {
          showNotification('Passwords do not match', 'error');
          return;
        }
        
        if (newPassword.length < 6) {
          showNotification('Password must be at least 6 characters', 'error');
          return;
        }
        
        localStorage.setItem('adminPassword', newPassword);
        setShowChangePassword(false);
        setNewPassword('');
        setConfirmPassword('');
        showNotification('Password changed successfully', 'success');
      };
      
      const showNotification = (message, type) => {
        setNotification({ message, type });
        setTimeout(() => setNotification(null), 3000);
      };
      
      const loadData = async () => {
        // Try Gist first if configured; otherwise fall back to local data.json
        if (gistId) {
          try {
            const metaRes = await fetch(`https://api.github.com/gists/${gistId}`);
            if (!metaRes.ok) throw new Error(`Gist metadata fetch failed: ${metaRes.status}`);
            const meta = await metaRes.json();
            const dataFile = meta.files && (meta.files['data.json'] || meta.files['data.JSON']);
            if (!dataFile || !dataFile.raw_url) throw new Error('data.json not found in Gist');
            const res = await fetch(`${dataFile.raw_url}?t=${Date.now()}`);
            if (!res.ok) throw new Error(`Gist raw fetch failed: ${res.status}`);
            const data = await res.json();
            setManagers(data.managers || []);
            setJsonData(JSON.stringify(data, null, 2));
            setDirty(false);
            return;
          } catch (err) {
            console.error('Gist load failed, falling back to local data.json:', err);
          }
        }
        try {
          const res = await fetch(`data.json?t=${Date.now()}`);
          const data = await res.json();
          setManagers(data.managers || []);
          setJsonData(JSON.stringify(data, null, 2));
          setDirty(false);
        } catch (error) {
          console.error('Error loading local data.json:', error);
          showNotification('Error loading data', 'error');
        }
      };
      
      const handlePickChange = (managerIndex, weekIndex, value) => {
        // Prevent duplicate team picks for the same manager
        if (value && managers[managerIndex].picks.some((p, idx) => idx !== weekIndex && p.team === value)) {
          showNotification('This team is already used in another week for this manager', 'error');
          return;
        }
        const updatedManagers = [...managers];
        updatedManagers[managerIndex].picks[weekIndex] = {
          ...updatedManagers[managerIndex].picks[weekIndex],
          team: value,
          manualResult: true, // Mark as manual when team is changed
          lastUpdated: new Date().toISOString()
        };
        setManagers(updatedManagers);
        updateJsonData(updatedManagers);
      };
      
      const handleResultChange = (managerIndex, weekIndex, value) => {
        const updatedManagers = [...managers];
        updatedManagers[managerIndex].picks[weekIndex] = {
          ...updatedManagers[managerIndex].picks[weekIndex],
          result: value,
          manualResult: true, // Mark as manual result
          lastUpdated: new Date().toISOString()
        };
        
        // Update elimination status
        if (value === 'L') {
          updatedManagers[managerIndex].eliminated = true;
        } else {
          // Check if manager has any other losses
          const hasLoss = updatedManagers[managerIndex].picks.some(p => p.result === 'L');
          updatedManagers[managerIndex].eliminated = hasLoss;
        }
        
        setManagers(updatedManagers);
        updateJsonData(updatedManagers);
      };
      
      const handleManagerInfoChange = (managerIndex, field, value) => {
        const updatedManagers = [...managers];
        updatedManagers[managerIndex][field] = field === 'lastYearRank' ? parseInt(value) : value;
        setManagers(updatedManagers);
        updateJsonData(updatedManagers);
      };
      
      const handleMarginChange = (managerIndex, weekIndex, margin) => {
        const updatedManagers = [...managers];
        updatedManagers[managerIndex].picks[weekIndex] = {
          ...updatedManagers[managerIndex].picks[weekIndex],
          margin: margin,
          manualResult: true, // Mark as manual when margin is changed
          lastUpdated: new Date().toISOString()
        };
        
        // Recalculate total margin of victory
        let totalMargin = 0;
        updatedManagers[managerIndex].picks.forEach(pick => {
          if (pick.result === 'W' && pick.margin) {
            totalMargin += pick.margin;
          }
        });
        updatedManagers[managerIndex].marginOfVictory = totalMargin;
        
        setManagers(updatedManagers);
        updateJsonData(updatedManagers);
      };
      
      const updateJsonData = (updatedManagers) => {
        const data = {
          managers: updatedManagers,
          lastUpdated: new Date().toISOString()
        };
        setJsonData(JSON.stringify(data, null, 2));
        setDirty(true);
      };

      // Copy current JSON to clipboard
      const copyJson = async () => {
        try {
          await navigator.clipboard.writeText(jsonData);
          showNotification('Copied JSON to clipboard', 'success');
        } catch (e) {
          showNotification('Copy failed', 'error');
        }
      };

      // Trigger hidden file input to import JSON
      const handleImportClick = () => {
        if (fileInputRef.current) fileInputRef.current.value = '';
        fileInputRef.current?.click();
      };

      // Handle JSON file selection
      const handleFileSelected = async (e) => {
        try {
          const file = e.target.files && e.target.files[0];
          if (!file) return;
          const text = await file.text();
          const data = JSON.parse(text);
          if (!data || typeof data !== 'object' || !Array.isArray(data.managers)) {
            throw new Error('Invalid JSON format: expected { managers: [...] }');
          }
          setManagers(data.managers);
          setJsonData(JSON.stringify({
            managers: data.managers,
            lastUpdated: new Date().toISOString()
          }, null, 2));
          setDirty(true);
          showNotification('Imported JSON successfully', 'success');
        } catch (err) {
          console.error(err);
          showNotification('Import failed. Ensure valid data.json structure.', 'error');
        }
      };

      // Save current jsonData to configured Gist
      const saveToGist = async () => {
        if (!gistId || !gistToken) {
          showNotification('Configure Gist ID and Token in Settings first', 'error');
          return;
        }
        try {
          setIsSaving(true);
          const payload = {
            files: {
              'data.json': { content: jsonData }
            }
          };
          const res = await fetch(`https://api.github.com/gists/${gistId}`, {
            method: 'PATCH',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `token ${gistToken}`
            },
            body: JSON.stringify(payload)
          });
          if (!res.ok) {
            const t = await res.text();
            throw new Error(`Gist save failed: ${res.status} ${t}`);
          }
          setDirty(false);
          showNotification('Saved to Gist successfully', 'success');
        } catch (err) {
          console.error(err);
          showNotification('Failed to save to Gist. Check Settings.', 'error');
        } finally {
          setIsSaving(false);
        }
      };

      // Persist Settings to localStorage
      const saveSettings = () => {
        localStorage.setItem('gistId', gistId.trim());
        localStorage.setItem('gistToken', gistToken.trim());
        setShowSettings(false);
        showNotification('Settings saved locally', 'success');
      };
      
      const resetElimination = (managerIndex) => {
        const updatedManagers = [...managers];
        updatedManagers[managerIndex].eliminated = false;
        updatedManagers[managerIndex].marginOfVictory = 0;
        
        // Reset all results
        updatedManagers[managerIndex].picks.forEach(pick => {
          pick.result = null;
        });
        
        setManagers(updatedManagers);
        updateJsonData(updatedManagers);
        showNotification('Manager reset successfully', 'success');
      };
      
      const resetPick = (managerIndex, weekIndex) => {
        const updatedManagers = [...managers];
        updatedManagers[managerIndex].picks[weekIndex] = {
          ...updatedManagers[managerIndex].picks[weekIndex],
          team: '',
          result: null,
          margin: 0,
          manualResult: false,
          lastUpdated: new Date().toISOString()
        };
        
        // Recalculate total margin of victory
        let totalMargin = 0;
        updatedManagers[managerIndex].picks.forEach(pick => {
          if (pick.result === 'W' && pick.margin) {
            totalMargin += pick.margin;
          }
        });
        updatedManagers[managerIndex].marginOfVictory = totalMargin;
        
        // Update elimination status
        const hasLoss = updatedManagers[managerIndex].picks.some(p => p.result === 'L');
        updatedManagers[managerIndex].eliminated = hasLoss;
        
        setManagers(updatedManagers);
        updateJsonData(updatedManagers);
        showNotification('Weekly pick reset successfully', 'success');
      };
      
      const addManager = () => {
        if (!newManager.name.trim() || !newManager.teamLabel.trim()) {
          showNotification('Please fill in all fields', 'error');
          return;
        }
        
        const managerToAdd = {
          ...newManager,
          picks: [
            { week: 1, team: '', result: null },
            { week: 2, team: '', result: null },
            { week: 3, team: '', result: null }
          ],
          eliminated: false,
          marginOfVictory: 0
        };
        
        const updatedManagers = [...managers, managerToAdd];
        setManagers(updatedManagers);
        updateJsonData(updatedManagers);
        
        setNewManager({ name: '', teamLabel: '', lastYearRank: 11 });
        setShowAddManager(false);
        showNotification('Manager added successfully', 'success');
      };
      
      const removeManager = (managerIndex) => {
        if (window.confirm('Are you sure you want to remove this manager?')) {
          const updatedManagers = [...managers];
          updatedManagers.splice(managerIndex, 1);
          setManagers(updatedManagers);
          updateJsonData(updatedManagers);
          showNotification('Manager removed successfully', 'success');
        }
      };
      
      const downloadJson = () => {
        const blob = new Blob([jsonData], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'data.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showNotification('Data downloaded successfully', 'success');
      };
      
      if (!authenticated) {
        return (
          <div className="min-h-screen flex items-center justify-center p-4">
            <div className="glass rounded-2xl p-8 max-w-md w-full">
              <div className="text-center mb-8">
                <h1 className="text-3xl font-bold mb-2">Admin Login</h1>
                <p className="text-purple-200">Enter your password to access the admin panel</p>
              </div>
              
              <div className="space-y-4">
                <div>
                  <label className="block text-sm font-medium mb-1">Password</label>
                  <input
                    type="password"
                    value={password}
                    onChange={(e) => setPassword(e.target.value)}
                    className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                    placeholder="Enter password"
                  />
                </div>
                
                {error && (
                  <div className="text-red-400 text-sm">{error}</div>
                )}
                
                <button
                  onClick={handleLogin}
                  className="w-full py-3 bg-purple-600 hover:bg-purple-700 rounded-lg font-medium transition-colors"
                >
                  Login
                </button>
              </div>
              
              <div className="mt-6 text-center text-sm text-purple-300">
                <p>Default password: <span className="font-mono">survivor2025</span></p>
                <p className="mt-2">Change this after first login for security</p>
              </div>
            </div>
          </div>
        );
      }
      
      return (
        <div className="min-h-screen p-4">
          <div className="max-w-6xl mx-auto">
            {/* Header */}
            <header className="py-6 mb-8">
              <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                  <h1 className="text-3xl font-bold flex items-center gap-3">
                    <i className="fas fa-user-shield"></i>
                    Admin Panel
                  </h1>
                  <p className="text-purple-200 mt-1">Manage your NFL Survivor Pool</p>
                </div>
                <div className="flex flex-wrap gap-3">
                  <button
                    onClick={() => setShowSettings(true)}
                    className="px-4 py-2 bg-gray-700 hover:bg-gray-600 rounded-lg transition-colors flex items-center gap-2"
                    title="Configure GitHub Gist persistence"
                  >
                    <i className="fas fa-gear"></i>
                    Settings
                  </button>
                  <button
                    onClick={handleImportClick}
                    className="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg transition-colors flex items-center gap-2"
                    title="Import data.json from your computer"
                  >
                    <i className="fas fa-file-import"></i>
                    Import JSON
                  </button>
                  <button
                    onClick={saveToGist}
                    disabled={!dirty || isSaving}
                    className={`px-4 py-2 rounded-lg transition-colors flex items-center gap-2 ${(!dirty || isSaving) ? 'bg-green-800 cursor-not-allowed opacity-70' : 'bg-green-600 hover:bg-green-700'}`}
                    title="Save current changes to Gist"
                  >
                    <i className={`fas ${isSaving ? 'fa-spinner fa-spin' : 'fa-cloud-upload-alt'}`}></i>
                    {isSaving ? 'Savingâ€¦' : 'Save to Gist'}
                  </button>
                  <button
                    onClick={() => setShowChangePassword(true)}
                    className="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 rounded-lg transition-colors flex items-center gap-2"
                  >
                    <i className="fas fa-key"></i>
                    Change Password
                  </button>
                  <button
                    onClick={() => setShowJson(!showJson)}
                    className="px-4 py-2 bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors"
                  >
                    {showJson ? 'Hide JSON' : 'Show JSON'}
                  </button>
                  <button
                    onClick={copyJson}
                    className="px-4 py-2 bg-teal-600 hover:bg-teal-700 rounded-lg transition-colors flex items-center gap-2"
                    title="Copy current JSON to clipboard"
                  >
                    <i className="fas fa-clipboard"></i>
                    Copy JSON
                  </button>
                  <button
                    onClick={downloadJson}
                    className="px-4 py-2 bg-green-600 hover:bg-green-700 rounded-lg transition-colors flex items-center gap-2"
                  >
                    <i className="fas fa-download"></i>
                    Download data.json
                  </button>
                  <button
                    onClick={() => {
                      localStorage.removeItem('adminAuthenticated');
                      setAuthenticated(false);
                    }}
                    className="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg transition-colors"
                  >
                    Logout
                  </button>
                </div>
              </div>
              {dirty && (
                <div className="text-sm text-yellow-300 mt-2 flex items-center gap-2">
                  <i className="fas fa-circle-exclamation"></i>
                  You have unsaved changes. Click "Save to Gist".
                </div>
              )}
            </header>
            
            {/* JSON Editor */}
            {showJson && (
              <div className="glass rounded-2xl p-5 mb-8">
                <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                  <i className="fas fa-code"></i> JSON Data
                </h2>
                <div className="bg-black/30 rounded-lg p-4 overflow-auto max-h-96">
                  <pre className="text-sm text-green-300">{jsonData}</pre>
                </div>
                <div className="mt-4 text-sm text-purple-300">
                  <p>After making changes, download this file and replace the data.json in your repository.</p>
                </div>
              </div>
            )}
            
            {/* Add Manager Button */}
            <div className="mb-6">
              <button
                onClick={() => setShowAddManager(true)}
                className="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg transition-colors flex items-center gap-2"
              >
                <i className="fas fa-plus"></i>
                Add New Manager
              </button>
            </div>
            
            {/* Manager Cards */}
            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
              {managers.map((manager, managerIndex) => (
                <div key={managerIndex} className="glass rounded-2xl p-5">
                  <div className="flex justify-between items-start mb-4">
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-1">
                        <input
                          type="text"
                          value={manager.name}
                          onChange={(e) => handleManagerInfoChange(managerIndex, 'name', e.target.value)}
                          className="text-xl font-bold bg-transparent border-b border-white/30 focus:outline-none focus:border-purple-400"
                        />
                        <button
                          onClick={() => removeManager(managerIndex)}
                          className="text-red-400 hover:text-red-300"
                          title="Remove manager"
                        >
                          <i className="fas fa-trash-alt"></i>
                        </button>
                      </div>
                      <input
                        type="text"
                        value={manager.teamLabel}
                        onChange={(e) => handleManagerInfoChange(managerIndex, 'teamLabel', e.target.value)}
                        className="text-sm italic text-fuchsia-200 bg-transparent border-b border-white/30 focus:outline-none focus:border-purple-400 w-full max-w-xs"
                      />
                    </div>
                    <div className="flex gap-2">
                      <span className={`px-3 py-1 rounded-full text-sm font-medium ${
                        manager.eliminated 
                          ? 'bg-red-500/80' 
                          : 'bg-green-500/80'
                      }`}>
                        {manager.eliminated ? 'Eliminated' : 'Alive'}
                      </span>
                      <button
                        onClick={() => resetElimination(managerIndex)}
                        className="px-3 py-1 bg-yellow-600 hover:bg-yellow-700 rounded-lg text-sm transition-colors"
                        title="Reset elimination status"
                      >
                        <i className="fas fa-undo"></i>
                      </button>
                    </div>
                  </div>
                  
                  <div className="space-y-4">
                    <h3 className="font-semibold text-purple-200">Weekly Picks</h3>
                    
                    {manager.picks.map((pick, weekIndex) => (
                      <div key={weekIndex} className="grid grid-cols-1 md:grid-cols-4 gap-3">
                        <div>
                          <label className="block text-sm mb-1">Week {pick.week} Team</label>
                          <select
                            value={pick.team}
                            onChange={(e) => handlePickChange(managerIndex, weekIndex, e.target.value)}
                            className="w-full p-2 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                          >
                            <option value="">Select a team</option>
                            {nflTeams.map(team => (
                              <option
                                key={team}
                                value={team}
                                disabled={manager.picks.some((p, idx) => idx !== weekIndex && p.team === team)}
                              >
                                {team}
                                {manager.picks.some((p, idx) => idx !== weekIndex && p.team === team) ? ' (used)' : ''}
                              </option>
                            ))}
                          </select>
                        </div>
                        
                        <div>
                          <label className="block text-sm mb-1">Result</label>
                          <select
                            value={pick.result || ''}
                            onChange={(e) => handleResultChange(managerIndex, weekIndex, e.target.value || null)}
                            className="w-full p-2 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                          >
                            <option value="">Not decided</option>
                            <option value="W">Win</option>
                            <option value="L">Loss</option>
                          </select>
                        </div>
                        
                        <div>
                          <label className="block text-sm mb-1">Margin</label>
                          <input
                            type="number"
                            value={pick.margin || ''}
                            onChange={(e) => handleMarginChange(managerIndex, weekIndex, parseInt(e.target.value) || 0)}
                            className="w-full p-2 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                            placeholder="Score diff"
                          />
                        </div>
                        
                        <div>
                          <label className="block text-sm mb-1">Reset</label>
                          <button
                            onClick={() => resetPick(managerIndex, weekIndex)}
                            className="w-full p-2 bg-red-600 hover:bg-red-700 rounded-lg text-white transition-colors flex items-center justify-center gap-1"
                            title="Reset this week's pick"
                          >
                            <i className="fas fa-undo"></i>
                            Reset
                          </button>
                        </div>
                      </div>
                    ))}
                  </div>
                  
                  <div className="mt-4 pt-4 border-t border-white/10 flex flex-wrap gap-4">
                    <div>
                      <span className="text-sm">Margin of Victory: </span>
                      <span className="font-bold">{manager.marginOfVictory}</span>
                    </div>
                    <div>
                      <span className="text-sm">Last Year Rank: </span>
                      <input
                        type="number"
                        min="1"
                        max="20"
                        value={manager.lastYearRank}
                        onChange={(e) => handleManagerInfoChange(managerIndex, 'lastYearRank', parseInt(e.target.value))}
                        className="w-16 p-1 rounded text-white focus:outline-none focus:ring-1 focus:ring-purple-500"
                      />
                    </div>
                  </div>
                </div>
              ))}
            </div>
            
            {/* Instructions */}
            <div className="glass rounded-2xl p-5">
              <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                <i className="fas fa-info-circle"></i> How to Update Your Site
              </h2>
              <ol className="list-decimal pl-5 space-y-2">
                <li>Make changes to manager picks and results using the forms above</li>
                <li>Click "Download data.json" to get the updated file</li>
                <li>Go to your GitHub repository and replace the existing data.json file with your downloaded version</li>
                <li>Commit and push the changes to update your live site</li>
              </ol>
              <div className="mt-4 p-4 bg-yellow-500/20 rounded-lg">
                <p className="text-sm"><strong>Note:</strong> Changes will appear on the live site after a few minutes once GitHub Pages updates.</p>
              </div>
            </div>
          </div>
          {/* Hidden file input for import */}
          <input
            type="file"
            accept="application/json"
            ref={fileInputRef}
            onChange={handleFileSelected}
            style={{ display: 'none' }}
          />

          {/* Settings Modal */}
          {showSettings && (
            <div className="modal" role="dialog" aria-modal="true" aria-label="Gist Settings">
              <div className="glass rounded-2xl p-6 max-w-md w-full">
                <h2 className="text-2xl font-bold mb-4 flex items-center gap-2">
                  <i className="fas fa-gear"></i> Data Persistence Settings
                </h2>
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium mb-1">GitHub Gist ID</label>
                    <input
                      type="text"
                      value={gistId}
                      onChange={(e) => setGistId(e.target.value)}
                      className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                      placeholder="e.g. a1b2c3d4e5f6g7h8i9j0"
                    />
                    <p className="text-xs text-purple-200 mt-1">Create a Gist with a file named data.json. Paste its ID here.</p>
                  </div>
                  <div>
                    <label className="block text-sm font-medium mb-1">GitHub Personal Access Token (gist scope)</label>
                    <input
                      type="password"
                      value={gistToken}
                      onChange={(e) => setGistToken(e.target.value)}
                      className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                      placeholder="token stored locally"
                    />
                    <p className="text-xs text-purple-200 mt-1">Stored only in your browser (localStorage). Required to save.</p>
                  </div>
                </div>
                <div className="flex justify-end gap-3 mt-6">
                  <button onClick={() => setShowSettings(false)} className="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition-colors">Cancel</button>
                  <button onClick={saveSettings} className="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors">Save Settings</button>
                </div>
              </div>
            </div>
          )}

          {/* Change Password Modal */}
          {showChangePassword && (
            <div className="modal">
              <div className="glass rounded-2xl p-6 max-w-md w-full">
                <h2 className="text-2xl font-bold mb-4">Change Admin Password</h2>
                
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium mb-1">New Password</label>
                    <input
                      type="password"
                      value={newPassword}
                      onChange={(e) => setNewPassword(e.target.value)}
                      className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                      placeholder="Enter new password"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium mb-1">Confirm Password</label>
                    <input
                      type="password"
                      value={confirmPassword}
                      onChange={(e) => setConfirmPassword(e.target.value)}
                      className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                      placeholder="Confirm new password"
                    />
                  </div>
                </div>
                
                <div className="flex justify-end gap-3 mt-6">
                  <button
                    onClick={() => {
                      setShowChangePassword(false);
                      setNewPassword('');
                      setConfirmPassword('');
                    }}
                    className="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition-colors"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={handleChangePassword}
                    className="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors"
                  >
                    Change Password
                  </button>
                </div>
              </div>
            </div>
          )}
          
          {/* Add Manager Modal */}
          {showAddManager && (
            <div className="modal">
              <div className="glass rounded-2xl p-6 max-w-md w-full">
                <h2 className="text-2xl font-bold mb-4">Add New Manager</h2>
                
                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium mb-1">Manager Name</label>
                    <input
                      type="text"
                      value={newManager.name}
                      onChange={(e) => setNewManager({...newManager, name: e.target.value})}
                      className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                      placeholder="Enter manager name"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium mb-1">Team Label</label>
                    <input
                      type="text"
                      value={newManager.teamLabel}
                      onChange={(e) => setNewManager({...newManager, teamLabel: e.target.value})}
                      className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                      placeholder="Enter team label"
                    />
                  </div>
                  
                  <div>
                    <label className="block text-sm font-medium mb-1">Last Year Rank</label>
                    <input
                      type="number"
                      min="1"
                      max="20"
                      value={newManager.lastYearRank}
                      onChange={(e) => setNewManager({...newManager, lastYearRank: parseInt(e.target.value) || 11})}
                      className="w-full p-3 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                    />
                  </div>
                </div>
                
                <div className="flex justify-end gap-3 mt-6">
                  <button
                    onClick={() => {
                      setShowAddManager(false);
                      setNewManager({ name: '', teamLabel: '', lastYearRank: 11 });
                    }}
                    className="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-lg transition-colors"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={addManager}
                    className="px-4 py-2 bg-purple-600 hover:bg-purple-700 rounded-lg transition-colors"
                  >
                    Add Manager
                  </button>
                </div>
              </div>
            </div>
          )}
          
          {/* Notification */}
          {notification && (
            <div className={`notification ${notification.type}`}>
              {notification.message}
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<AdminPanel />);
  </script>
</body>
</html>
